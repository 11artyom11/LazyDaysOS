@import url(https://themes.googleusercontent.com/fonts/css?kit=7h0XsjiL8maQ3JW63ANnAgohwd-CPx7j7U14bhg9n-yiBykvtyfAV4g2LFioppQcGHmWdqqwMOY05hpP63flFdq\_18t8TGWLfCHtOV-0mhifc6BAyiLStuIO2DKMOnQdROUnSYS2HP79-8De2s-JKA);.lst-kix\_ukjkin6s2gql-7>li:before{content:"\\0025cb "}.lst-kix\_ukjkin6s2gql-6>li:before{content:"\\0025cf "}.lst-kix\_ukjkin6s2gql-8>li:before{content:"\\0025a0 "}.lst-kix\_ukjkin6s2gql-5>li:before{content:"\\0025a0 "}ul.lst-kix\_sf3b2f9ek5ia-7{list-style-type:none}ul.lst-kix\_sf3b2f9ek5ia-8{list-style-type:none}ul.lst-kix\_sf3b2f9ek5ia-5{list-style-type:none}.lst-kix\_z5lyut7xgrc6-8>li:before{content:"\\0025a0 "}ul.lst-kix\_sf3b2f9ek5ia-6{list-style-type:none}.lst-kix\_ukjkin6s2gql-3>li:before{content:"\\0025cf "}ul.lst-kix\_sf3b2f9ek5ia-3{list-style-type:none}ul.lst-kix\_sf3b2f9ek5ia-4{list-style-type:none}.lst-kix\_ukjkin6s2gql-2>li:before{content:"\\0025a0 "}.lst-kix\_ukjkin6s2gql-4>li:before{content:"\\0025cb "}ul.lst-kix\_sf3b2f9ek5ia-1{list-style-type:none}.lst-kix\_z5lyut7xgrc6-5>li:before{content:"\\0025a0 "}.lst-kix\_z5lyut7xgrc6-7>li:before{content:"\\0025cb "}ul.lst-kix\_sf3b2f9ek5ia-2{list-style-type:none}ul.lst-kix\_sf3b2f9ek5ia-0{list-style-type:none}.lst-kix\_z5lyut7xgrc6-6>li:before{content:"\\0025cf "}.lst-kix\_ukjkin6s2gql-0>li:before{content:"\\0025cf "}.lst-kix\_z5lyut7xgrc6-1>li:before{content:"\\0025cb "}.lst-kix\_z5lyut7xgrc6-3>li:before{content:"\\0025cf "}.lst-kix\_ukjkin6s2gql-1>li:before{content:"\\0025cb "}.lst-kix\_z5lyut7xgrc6-0>li:before{content:"\\0025cf "}.lst-kix\_z5lyut7xgrc6-4>li:before{content:"\\0025cb "}ul.lst-kix\_8sfyo3nia2lg-3{list-style-type:none}ul.lst-kix\_8sfyo3nia2lg-2{list-style-type:none}ul.lst-kix\_8sfyo3nia2lg-1{list-style-type:none}ul.lst-kix\_8sfyo3nia2lg-0{list-style-type:none}ul.lst-kix\_8sfyo3nia2lg-7{list-style-type:none}ul.lst-kix\_8sfyo3nia2lg-6{list-style-type:none}ul.lst-kix\_8sfyo3nia2lg-5{list-style-type:none}.lst-kix\_z5lyut7xgrc6-2>li:before{content:"\\0025a0 "}ul.lst-kix\_8sfyo3nia2lg-4{list-style-type:none}.lst-kix\_i4btage90oo5-6>li:before{content:"\\0025cf "}ul.lst-kix\_be4rzsx55aab-0{list-style-type:none}ul.lst-kix\_be4rzsx55aab-1{list-style-type:none}ul.lst-kix\_be4rzsx55aab-2{list-style-type:none}.lst-kix\_i4btage90oo5-7>li:before{content:"\\0025cb "}ul.lst-kix\_be4rzsx55aab-3{list-style-type:none}ul.lst-kix\_be4rzsx55aab-4{list-style-type:none}ul.lst-kix\_be4rzsx55aab-5{list-style-type:none}ul.lst-kix\_be4rzsx55aab-6{list-style-type:none}ul.lst-kix\_be4rzsx55aab-7{list-style-type:none}ul.lst-kix\_be4rzsx55aab-8{list-style-type:none}.lst-kix\_i4btage90oo5-8>li:before{content:"\\0025a0 "}.lst-kix\_1bnh34wzv2xg-7>li:before{content:"\\0025cb "}.lst-kix\_1bnh34wzv2xg-5>li:before{content:"\\0025a0 "}.lst-kix\_1bnh34wzv2xg-4>li:before{content:"\\0025cb "}.lst-kix\_1bnh34wzv2xg-8>li:before{content:"\\0025a0 "}.lst-kix\_1bnh34wzv2xg-3>li:before{content:"\\0025cf "}.lst-kix\_1bnh34wzv2xg-2>li:before{content:"\\0025a0 "}.lst-kix\_1bnh34wzv2xg-6>li:before{content:"\\0025cf "}.lst-kix\_1bnh34wzv2xg-1>li:before{content:"\\0025cb "}.lst-kix\_1bnh34wzv2xg-0>li:before{content:"\\0025cf "}.lst-kix\_7uzyhvwmikcr-1>li:before{content:"\\0025cb "}ul.lst-kix\_sdy5vu92j3db-8{list-style-type:none}.lst-kix\_7uzyhvwmikcr-5>li:before{content:"\\0025a0 "}ul.lst-kix\_sdy5vu92j3db-7{list-style-type:none}ul.lst-kix\_sdy5vu92j3db-6{list-style-type:none}ul.lst-kix\_sdy5vu92j3db-5{list-style-type:none}.lst-kix\_7uzyhvwmikcr-3>li:before{content:"\\0025cf "}ul.lst-kix\_sdy5vu92j3db-0{list-style-type:none}ul.lst-kix\_sdy5vu92j3db-4{list-style-type:none}ul.lst-kix\_sdy5vu92j3db-3{list-style-type:none}ul.lst-kix\_sdy5vu92j3db-2{list-style-type:none}ul.lst-kix\_sdy5vu92j3db-1{list-style-type:none}.lst-kix\_7uzyhvwmikcr-7>li:before{content:"\\0025cb "}ul.lst-kix\_gl5yhk2qlkt7-6{list-style-type:none}ul.lst-kix\_gl5yhk2qlkt7-7{list-style-type:none}ul.lst-kix\_gl5yhk2qlkt7-4{list-style-type:none}ul.lst-kix\_gl5yhk2qlkt7-5{list-style-type:none}ul.lst-kix\_gl5yhk2qlkt7-8{list-style-type:none}.lst-kix\_8sfyo3nia2lg-4>li:before{content:"\\0025cb "}.lst-kix\_gl5yhk2qlkt7-3>li:before{content:"\\0025cf "}.lst-kix\_8sfyo3nia2lg-0>li:before{content:"\\0025cf "}ul.lst-kix\_wyt263j7bwok-0{list-style-type:none}ul.lst-kix\_wyt263j7bwok-1{list-style-type:none}ul.lst-kix\_gl5yhk2qlkt7-2{list-style-type:none}ul.lst-kix\_wyt263j7bwok-2{list-style-type:none}.lst-kix\_8sfyo3nia2lg-2>li:before{content:"\\0025a0 "}ul.lst-kix\_gl5yhk2qlkt7-3{list-style-type:none}ul.lst-kix\_wyt263j7bwok-3{list-style-type:none}ul.lst-kix\_gl5yhk2qlkt7-0{list-style-type:none}.lst-kix\_gl5yhk2qlkt7-5>li:before{content:"\\0025a0 "}ul.lst-kix\_wyt263j7bwok-4{list-style-type:none}ul.lst-kix\_gl5yhk2qlkt7-1{list-style-type:none}ul.lst-kix\_wyt263j7bwok-5{list-style-type:none}ul.lst-kix\_wyt263j7bwok-6{list-style-type:none}ul.lst-kix\_wyt263j7bwok-7{list-style-type:none}.lst-kix\_wyt263j7bwok-1>li:before{content:"\\0025cb "}ul.lst-kix\_wyt263j7bwok-8{list-style-type:none}ul.lst-kix\_i4btage90oo5-7{list-style-type:none}ul.lst-kix\_i4btage90oo5-8{list-style-type:none}ul.lst-kix\_i4btage90oo5-5{list-style-type:none}.lst-kix\_48ezh2nmda5f-4>li:before{content:"\\0025cb "}.lst-kix\_48ezh2nmda5f-8>li:before{content:"\\0025a0 "}.lst-kix\_gl5yhk2qlkt7-7>li:before{content:"\\0025cb "}ul.lst-kix\_i4btage90oo5-6{list-style-type:none}.lst-kix\_sf3b2f9ek5ia-3>li:before{content:"\\0025cf "}.lst-kix\_wyt263j7bwok-5>li:before{content:"\\0025a0 "}.lst-kix\_i4btage90oo5-4>li:before{content:"\\0025cb "}.lst-kix\_sf3b2f9ek5ia-1>li:before{content:"\\0025cb "}.lst-kix\_8sfyo3nia2lg-6>li:before{content:"\\0025cf "}.lst-kix\_48ezh2nmda5f-6>li:before{content:"\\0025cf "}.lst-kix\_i4btage90oo5-2>li:before{content:"\\0025a0 "}.lst-kix\_8sfyo3nia2lg-8>li:before{content:"\\0025a0 "}.lst-kix\_wyt263j7bwok-3>li:before{content:"\\0025cf "}.lst-kix\_i4btage90oo5-0>li:before{content:"\\0025cf "}.lst-kix\_sf3b2f9ek5ia-7>li:before{content:"\\0025cb "}.lst-kix\_wyt263j7bwok-7>li:before{content:"\\0025cb "}ul.lst-kix\_i4btage90oo5-3{list-style-type:none}ul.lst-kix\_i4btage90oo5-4{list-style-type:none}ul.lst-kix\_i4btage90oo5-1{list-style-type:none}ul.lst-kix\_i4btage90oo5-2{list-style-type:none}.lst-kix\_sf3b2f9ek5ia-5>li:before{content:"\\0025a0 "}ul.lst-kix\_i4btage90oo5-0{list-style-type:none}ul.lst-kix\_1bnh34wzv2xg-1{list-style-type:none}.lst-kix\_be4rzsx55aab-3>li:before{content:"\\0025cf "}.lst-kix\_be4rzsx55aab-4>li:before{content:"\\0025cb "}ul.lst-kix\_1bnh34wzv2xg-2{list-style-type:none}ul.lst-kix\_1bnh34wzv2xg-0{list-style-type:none}ul.lst-kix\_1bnh34wzv2xg-5{list-style-type:none}.lst-kix\_be4rzsx55aab-1>li:before{content:"\\0025cb "}.lst-kix\_be4rzsx55aab-2>li:before{content:"\\0025a0 "}.lst-kix\_be4rzsx55aab-5>li:before{content:"\\0025a0 "}.lst-kix\_be4rzsx55aab-6>li:before{content:"\\0025cf "}ul.lst-kix\_1bnh34wzv2xg-6{list-style-type:none}ul.lst-kix\_1bnh34wzv2xg-3{list-style-type:none}ul.lst-kix\_1bnh34wzv2xg-4{list-style-type:none}.lst-kix\_be4rzsx55aab-0>li:before{content:"\\0025cf "}.lst-kix\_sdy5vu92j3db-4>li:before{content:"\\0025cb "}.lst-kix\_sdy5vu92j3db-5>li:before{content:"\\0025a0 "}.lst-kix\_sdy5vu92j3db-6>li:before{content:"\\0025cf "}.lst-kix\_sdy5vu92j3db-7>li:before{content:"\\0025cb "}.lst-kix\_sdy5vu92j3db-8>li:before{content:"\\0025a0 "}.lst-kix\_48ezh2nmda5f-0>li:before{content:"\\0025cf "}.lst-kix\_48ezh2nmda5f-1>li:before{content:"\\0025cb "}.lst-kix\_48ezh2nmda5f-2>li:before{content:"\\0025a0 "}.lst-kix\_be4rzsx55aab-7>li:before{content:"\\0025cb "}.lst-kix\_be4rzsx55aab-8>li:before{content:"\\0025a0 "}ul.lst-kix\_1bnh34wzv2xg-7{list-style-type:none}ul.lst-kix\_1bnh34wzv2xg-8{list-style-type:none}.lst-kix\_48ezh2nmda5f-3>li:before{content:"\\0025cf "}ul.lst-kix\_ukjkin6s2gql-4{list-style-type:none}ul.lst-kix\_ukjkin6s2gql-5{list-style-type:none}ul.lst-kix\_ukjkin6s2gql-6{list-style-type:none}ul.lst-kix\_ukjkin6s2gql-7{list-style-type:none}ul.lst-kix\_ukjkin6s2gql-0{list-style-type:none}ul.lst-kix\_ukjkin6s2gql-1{list-style-type:none}ul.lst-kix\_ukjkin6s2gql-2{list-style-type:none}ul.lst-kix\_ukjkin6s2gql-3{list-style-type:none}.lst-kix\_gl5yhk2qlkt7-2>li:before{content:"\\0025a0 "}.lst-kix\_gl5yhk2qlkt7-1>li:before{content:"\\0025cb "}.lst-kix\_gl5yhk2qlkt7-0>li:before{content:"\\0025cf "}ul.lst-kix\_ukjkin6s2gql-8{list-style-type:none}.lst-kix\_sdy5vu92j3db-3>li:before{content:"\\0025cf "}.lst-kix\_sdy5vu92j3db-1>li:before{content:"\\0025cb "}.lst-kix\_sdy5vu92j3db-2>li:before{content:"\\0025a0 "}.lst-kix\_sdy5vu92j3db-0>li:before{content:"\\0025cf "}.lst-kix\_7uzyhvwmikcr-0>li:before{content:"\\0025cf "}.lst-kix\_7uzyhvwmikcr-2>li:before{content:"\\0025a0 "}.lst-kix\_7uzyhvwmikcr-4>li:before{content:"\\0025cb "}.lst-kix\_7uzyhvwmikcr-8>li:before{content:"\\0025a0 "}.lst-kix\_7uzyhvwmikcr-6>li:before{content:"\\0025cf "}ul.lst-kix\_7uzyhvwmikcr-8{list-style-type:none}ul.lst-kix\_7uzyhvwmikcr-7{list-style-type:none}ul.lst-kix\_7uzyhvwmikcr-4{list-style-type:none}ul.lst-kix\_7uzyhvwmikcr-3{list-style-type:none}ul.lst-kix\_7uzyhvwmikcr-6{list-style-type:none}ul.lst-kix\_7uzyhvwmikcr-5{list-style-type:none}ul.lst-kix\_7uzyhvwmikcr-0{list-style-type:none}ul.lst-kix\_7uzyhvwmikcr-2{list-style-type:none}ul.lst-kix\_7uzyhvwmikcr-1{list-style-type:none}.lst-kix\_8sfyo3nia2lg-3>li:before{content:"\\0025cf "}.lst-kix\_gl5yhk2qlkt7-4>li:before{content:"\\0025cb "}.lst-kix\_gl5yhk2qlkt7-6>li:before{content:"\\0025cf "}.lst-kix\_8sfyo3nia2lg-1>li:before{content:"\\0025cb "}.lst-kix\_48ezh2nmda5f-5>li:before{content:"\\0025a0 "}.lst-kix\_gl5yhk2qlkt7-8>li:before{content:"\\0025a0 "}.lst-kix\_wyt263j7bwok-0>li:before{content:"\\0025cf "}.lst-kix\_sf3b2f9ek5ia-0>li:before{content:"\\0025cf "}.lst-kix\_sf3b2f9ek5ia-2>li:before{content:"\\0025a0 "}.lst-kix\_48ezh2nmda5f-7>li:before{content:"\\0025cb "}.lst-kix\_wyt263j7bwok-6>li:before{content:"\\0025cf "}.lst-kix\_i4btage90oo5-5>li:before{content:"\\0025a0 "}.lst-kix\_8sfyo3nia2lg-5>li:before{content:"\\0025a0 "}.lst-kix\_i4btage90oo5-3>li:before{content:"\\0025cf "}.lst-kix\_8sfyo3nia2lg-7>li:before{content:"\\0025cb "}.lst-kix\_wyt263j7bwok-4>li:before{content:"\\0025cb "}.lst-kix\_wyt263j7bwok-2>li:before{content:"\\0025a0 "}.lst-kix\_i4btage90oo5-1>li:before{content:"\\0025cb "}ul.lst-kix\_8sfyo3nia2lg-8{list-style-type:none}ul.lst-kix\_48ezh2nmda5f-4{list-style-type:none}ul.lst-kix\_48ezh2nmda5f-3{list-style-type:none}ul.lst-kix\_48ezh2nmda5f-2{list-style-type:none}ul.lst-kix\_48ezh2nmda5f-1{list-style-type:none}ul.lst-kix\_48ezh2nmda5f-8{list-style-type:none}ul.lst-kix\_48ezh2nmda5f-7{list-style-type:none}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ul.lst-kix\_48ezh2nmda5f-6{list-style-type:none}ul.lst-kix\_48ezh2nmda5f-5{list-style-type:none}.lst-kix\_wyt263j7bwok-8>li:before{content:"\\0025a0 "}.lst-kix\_sf3b2f9ek5ia-6>li:before{content:"\\0025cf "}.lst-kix\_sf3b2f9ek5ia-8>li:before{content:"\\0025a0 "}ul.lst-kix\_48ezh2nmda5f-0{list-style-type:none}ul.lst-kix\_z5lyut7xgrc6-2{list-style-type:none}ul.lst-kix\_z5lyut7xgrc6-1{list-style-type:none}ul.lst-kix\_z5lyut7xgrc6-0{list-style-type:none}ul.lst-kix\_z5lyut7xgrc6-6{list-style-type:none}ul.lst-kix\_z5lyut7xgrc6-5{list-style-type:none}ul.lst-kix\_z5lyut7xgrc6-4{list-style-type:none}.lst-kix\_sf3b2f9ek5ia-4>li:before{content:"\\0025cb "}ul.lst-kix\_z5lyut7xgrc6-3{list-style-type:none}ul.lst-kix\_z5lyut7xgrc6-8{list-style-type:none}ul.lst-kix\_z5lyut7xgrc6-7{list-style-type:none}ol{margin:0;padding:0}table td,table th{padding:0}.c75{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1.5pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:81.8pt;border-top-color:#000000;border-bottom-style:solid}.c15{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:167.2pt;border-top-color:#000000;border-bottom-style:solid}.c114{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:370.5pt;border-top-color:#000000;border-bottom-style:solid}.c113{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1.5pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:370.5pt;border-top-color:#000000;border-bottom-style:solid}.c57{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:35.2pt;border-top-color:#000000;border-bottom-style:solid}.c107{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:81.8pt;border-top-color:#000000;border-bottom-style:dotted}.c54{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:53.2pt;border-top-color:#000000;border-bottom-style:solid}.c43{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid}.c116{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:370.5pt;border-top-color:#000000;border-bottom-style:dotted}.c77{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:150pt;border-top-color:#000000;border-bottom-style:solid}.c59{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:81.8pt;border-top-color:#000000;border-bottom-style:solid}.c102{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:495pt;border-top-color:#000000;border-bottom-style:solid}.c6{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:126pt;border-top-color:#000000;border-bottom-style:solid}.c7{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:82.5pt;border-top-color:#000000;border-bottom-style:solid}.c10{background-color:#ffffff;color:#808000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10.5pt;font-family:"Consolas";font-style:normal}.c12{margin-left:36pt;padding-top:0pt;padding-left:0pt;padding-bottom:12pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"PT Serif";font-style:normal}.c1{padding-top:12pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:center;height:11pt}.c9{-webkit-text-decoration-skip:none;color:#1155cc;font-weight:400;text-decoration:underline;text-decoration-skip-ink:none;font-size:10pt;font-family:"PT Serif"}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"PT Serif";font-style:normal}.c21{padding-top:0pt;text-indent:36pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;text-align:left}.c49{-webkit-text-decoration-skip:none;color:#1155cc;font-weight:400;text-decoration:underline;text-decoration-skip-ink:none;font-family:"PT Serif"}.c123{padding-top:12pt;padding-bottom:3pt;line-height:1.0;page-break-after:avoid;text-align:left;margin-right:-43.6pt}.c117{padding-top:12pt;padding-bottom:0pt;line-height:1.0;text-align:center;margin-right:-43.6pt}.c101{padding-top:0pt;padding-bottom:16pt;line-height:1.15;page-break-after:avoid;text-align:left}.c84{padding-top:12pt;padding-bottom:0pt;line-height:1.0;text-align:left;margin-right:-32pt}.c8{background-color:#ffffff;font-size:10pt;font-family:"Consolas";color:#000000;font-weight:400}.c100{padding-top:14pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;text-align:left}.c97{padding-top:16pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;text-align:left}.c11{background-color:#ffffff;font-size:10.5pt;font-family:"Consolas";color:#008000;font-weight:400}.c60{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:center}.c71{padding-top:12pt;padding-bottom:0pt;line-height:1.0;text-align:left;margin-right:-58.5pt}.c120{padding-top:12pt;padding-bottom:3pt;line-height:1.0;page-break-after:avoid;text-align:center}.c63{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left;margin-right:-111pt}.c111{padding-top:0pt;text-indent:-36pt;padding-bottom:0pt;line-height:2.0;text-align:left}.c47{padding-top:12pt;padding-bottom:0pt;line-height:1.0;text-align:left;margin-right:-43.6pt}.c5{font-size:10pt;font-family:"Consolas";color:#008000;font-weight:400}.c19{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:center}.c46{color:#666666;font-weight:400;font-size:22pt;font-family:"Arial"}.c124{padding-top:0pt;padding-bottom:0pt;line-height:2.0;text-align:left}.c104{margin-left:auto;border-spacing:0;border-collapse:collapse;margin-right:auto}.c33{font-size:10pt;font-family:"Consolas";color:#000080;font-weight:400}.c14{font-size:10pt;font-family:"Consolas";color:#000000;font-weight:400}.c26{background-color:#ffffff;font-family:"Consolas";color:#808000;font-weight:400}.c121{padding-top:12pt;padding-bottom:0pt;line-height:1.0;text-align:center}.c115{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:right}.c17{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:left}.c27{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:center}.c32{font-size:10pt;font-family:"Consolas";color:#000000;font-weight:700}.c24{color:#000000;font-weight:400;font-size:11pt;font-family:"PT Serif"}.c20{margin-left:36pt;padding-left:0pt;orphans:2;widows:2}.c96{padding-top:0pt;padding-bottom:0pt;line-height:2.0;text-align:center}.c108{margin-left:-3.8pt;border-spacing:0;border-collapse:collapse;margin-right:auto}.c62{color:#666666;font-weight:400;font-size:12pt;font-family:"Arial"}.c79{-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline;text-decoration-skip-ink:none}.c25{background-color:#ffffff;font-family:"Consolas";color:#0055af;font-weight:400}.c66{padding-top:12pt;padding-bottom:0pt;line-height:1.15;text-align:center}.c51{border-spacing:0;border-collapse:collapse;margin-right:auto}.c13{font-size:10pt;font-family:"Consolas";color:#808000;font-weight:400}.c61{padding-top:0pt;padding-bottom:12pt;line-height:1.0;text-align:left}.c38{color:#000000;font-weight:400;font-size:13pt;font-family:"Arial"}.c98{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c4{font-size:10pt;font-family:"Consolas";color:#000080;font-weight:700}.c90{color:#434343;font-weight:400;font-family:"PT Serif"}.c118{font-weight:400;font-size:41pt;font-family:"Arial"}.c29{font-size:10pt;font-family:"PT Serif";font-weight:700}.c58{margin-left:0pt;list-style-position:inside;text-indent:45pt}.c74{color:#d4d4d4;font-weight:400;font-family:"Courier New"}.c86{font-weight:700;font-size:18pt;font-family:"Arial"}.c89{color:#ce9178;font-weight:400;font-family:"Courier New"}.c53{font-weight:400;font-size:20pt;font-family:"Arial"}.c22{font-size:10pt;font-family:"PT Serif";font-weight:400}.c18{orphans:2;widows:2;height:11pt}.c64{font-weight:400;font-size:11pt;font-family:"Roboto Serif"}.c23{text-decoration:none;vertical-align:baseline;font-style:normal}.c50{color:#188038;font-weight:400;font-family:"Roboto Mono"}.c68{text-decoration:none;vertical-align:baseline;font-size:14pt}.c92{color:#434343;font-weight:400;font-family:"Arial"}.c52{font-weight:400;font-size:11pt;font-family:"Arial"}.c67{font-family:"Consolas";color:#808000;font-weight:700}.c42{font-weight:400;font-size:17pt;font-family:"Arial"}.c55{font-family:"Consolas";color:#008000;font-weight:700}.c45{font-size:8pt;font-family:"PT Serif";font-weight:400}.c76{text-decoration:none;vertical-align:baseline;font-size:15pt}.c16{padding:0;margin:0}.c3{color:inherit;text-decoration:inherit}.c34{orphans:2;widows:2}.c83{text-decoration:none;vertical-align:baseline}.c112{width:33%;height:1px}.c40{font-weight:700;font-family:"PT Serif"}.c37{font-family:"Consolas";font-weight:400}.c119{font-weight:400;font-family:"Arial"}.c95{background-color:#333333;color:#888888}.c99{font-weight:400;font-family:"PT Serif"}.c72{font-weight:400;font-family:"Roboto Serif"}.c126{font-family:"Caveat";font-weight:700}.c81{max-width:451.4pt;padding:21.6pt 72pt 21.6pt 72pt}.c110{color:#000080}.c44{margin-left:36pt}.c87{font-size:22pt}.c125{font-size:12pt}.c70{color:#0055af}.c73{font-size:14pt}.c65{height:25.8pt}.c69{text-indent:36pt}.c103{font-size:16pt}.c80{margin-left:72pt}.c35{font-style:italic}.c94{color:#800000}.c122{color:#b7b7b7}.c28{height:0pt}.c48{color:#ffffff}.c41{color:#000000}.c36{font-size:10.5pt}.c109{font-size:9.5pt}.c39{font-size:10pt}.c105{font-size:7pt}.c88{height:169.8pt}.c106{font-size:15pt}.c85{padding-left:0pt}.c31{background-color:#ffffff}.c93{background-color:#efefef}.c56{font-size:9pt}.c91{color:#008000}.c78{font-size:8pt}.c30{height:11pt}.c82{font-size:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}

Author: Artyom Grigoryan  

  

  

  

  

  

LazyDaysOS

personal OS project

  

  

  

  

  

  

  

  

  

This project work is intended for students and graduates to read, it is not clear documentation and only personal notes and thoughts of young and inexperienced student (author).

Please do not consider this work as a full replacement of such good resources such as OSDev Wiki. This work is rather fiction.

This project idea was blobbing in my head for a very long time, but every time I was stuck to some kind of unpleasant feeling that I don’t have enough knowledge in some specific field, as by the time of writing this article I have very little experience for these kinds of projects.

But despite every barrier I dared to make this brave step and start to work on a project called LazyDaysOS.

  

By the time of writing first pages of this work I haven’t had  any idea how I want my OS look like, but I think it is fair to consider that when I already have a process scheduler working within my OS it would be in a “mission completed” state, as I understand how much energy and time it will take.

* * *

§ 0.1 Download, build and install binutils

Have these packages installed on your host machine before configuring any build files, otherwise you won’t be able to build either binutils or GCC

Firstly note that you will need this list of utilities installed on your host system before configuring gcc

↓ Dependency / OS →

Source Code

Debian (Ubuntu, Mint, WSL, ...)

How to install

Normally

sudo apt install dude

Compiler

N/A

build-essential

Make

N/A

build-essential

[Bison](https://www.google.com/url?q=https://www.gnu.org/software/bison/&sa=D&source=editors&ust=1703765820938067&usg=AOvVaw0tPOUop_qIOQj47j94Kc0K)

[\[1\]](https://www.google.com/url?q=https://ftp.gnu.org/gnu/bison/&sa=D&source=editors&ust=1703765820938758&usg=AOvVaw3mAbiATrFH51xtJa9fRWMt)

bison

[Flex](https://www.google.com/url?q=https://github.com/westes/flex&sa=D&source=editors&ust=1703765820939529&usg=AOvVaw1BvWypxThltiXc11Zc3L8D)

[\[2\]](https://www.google.com/url?q=https://github.com/westes/flex/releases&sa=D&source=editors&ust=1703765820940031&usg=AOvVaw2bkjlREaTGnfgI-pAAIYez)

flex

[GMP](https://www.google.com/url?q=https://gmplib.org/&sa=D&source=editors&ust=1703765820940773&usg=AOvVaw2skEy6KA-lfpg7invM2i-C)

[\[3\]](https://www.google.com/url?q=https://ftp.gnu.org/gnu/gmp/&sa=D&source=editors&ust=1703765820941257&usg=AOvVaw1H00LKJ4iabn0b6Q6oKGB1)

libgmp3-dev

MPC

[\[4\]](https://www.google.com/url?q=https://ftp.gnu.org/gnu/mpc/&sa=D&source=editors&ust=1703765820942412&usg=AOvVaw3yl5NfO4_peiwBaLbET-7i)

libmpc-dev

[MPFR](https://www.google.com/url?q=https://www.mpfr.org/&sa=D&source=editors&ust=1703765820943182&usg=AOvVaw1SPGIPjS26Mr5ZfZ63M7Jg)

[\[5\]](https://www.google.com/url?q=https://ftp.gnu.org/gnu/mpfr/&sa=D&source=editors&ust=1703765820943673&usg=AOvVaw2bUQLfqg-CkEAoZ6wefRMK)

libmpfr-dev

[Texinfo](https://www.google.com/url?q=https://www.gnu.org/software/texinfo/&sa=D&source=editors&ust=1703765820944425&usg=AOvVaw1RP4GzdVNCMKVlTeE1Flw-)

[\[6\]](https://www.google.com/url?q=https://ftp.gnu.org/gnu/texinfo/&sa=D&source=editors&ust=1703765820944857&usg=AOvVaw0PecYEfC-IOx137KAy3r4y)

texinfo

[CLooG](https://www.google.com/url?q=https://www.cloog.org/&sa=D&source=editors&ust=1703765820945562&usg=AOvVaw2yLaMT6MxI_jA0eWTN35R6) (Optional)

[CLooG](https://www.google.com/url?q=https://www.cloog.org/&sa=D&source=editors&ust=1703765820946018&usg=AOvVaw3rAj49DH2B_jg6h4jCYBOL)

libcloog-isl-dev

[ISL](https://www.google.com/url?q=http://isl.gforge.inria.fr/&sa=D&source=editors&ust=1703765820946703&usg=AOvVaw3JOPSZmatqmQwGFGmmeD9t) (Optional)

[\[7\]](https://www.google.com/url?q=http://isl.gforge.inria.fr/&sa=D&source=editors&ust=1703765820947174&usg=AOvVaw0E7n_TjfLvukkQYUrGWwrX)

libisl-dev

First guide I have found as a guide is OSDev Wiki, and after reading header articles “Getting started” I learned that I need binutils, gdb, and gcc cross tools to make the first steps.

What is binutils? According to their official website binutils contain a bunch of binary utilities that are needed for comfortable working within an OS environment.  
Main ones are  

*   ld - the GNU linker
*   as - the GNU assembler
*   gold - a new, faster, ELF only linker

So let’s download it and build.

OSDev Wiki (Wiki) says that it is advisable to have your binutils installed at $HOME/opt/cross location in order to not have any conflicts with your running OS (linux (Ubuntu 22.04 LTS) in this very case) binutils.

After downloading binutils from a public [repository](https://www.google.com/url?q=https://iq.opengenus.org/build-binutils-from-source/&sa=D&source=editors&ust=1703765820948706&usg=AOvVaw3IYMytBY865_IcuBF-fxfz)  into my project folder[\[1\]](#ftnt1) I need to build it. Note that the build process is running by 30 minutes on my fairly old Acer.

 tyom@tyom-pc~/workspace/LazyDaysOS  tree -L 1 ./  
./  
├── binutils-gdb  
├── build-binutils  
├── build-gcc  
├── gcc  
├── gdb-12.1

└── kernel

Having this kind of directory structure by that time, and 3 variables exported:

$ export PREFIX\="$HOME/opt/cross"$ export TARGET\=i686-elf  
$ export PATH\="$PREFIX/bin:$PATH"

In directory build-binutils I ran

$ ../binutils-gdb/configure \--target=$TARGET \--prefix="$PREFIX" \--with-sysroot \--disable-nls \--disable-werror

In order to configure my Makefile for my environment and check the existence of required environmental setup. After I have Makefile generated under my build directory I ran  

$ make$ make install

After having it installed I checked the presence of binaries under the $HOME/opt/cross directory, and yay! Now we have binutils!!

tyom@tyom-pc  ~/workspace/LazyDaysOS  ls ~/opt/cross/  
bin  i686-elf  include  lib  libexec  share

* * *

§ 0.2 Download, build and install GCC

Downloading GCC sources from  git://gcc.gnu.org/git/gcc.git

It requires a lot more time than I expected, even having high speed wifi connection (300 Mbps) ~ 10 min for downloading only the repository…

When the repository is cloned, we are ready to build GCC either, and, let’s configure it first.  

LazyDaysOS$ mkdir build-gccLazyDaysOS$ cd build-gccbuild-gcc$ ../gcc/configure --target=$TARGET --prefix="$PREFIX" --disable\-nls --enable\-languages=c,c++ --without-headers

This will normally create Makefile under your build directory.  
Now it is time to make GCC for our future OS business.  

build-gcc$ make all-gccbuild-gcc$ make all-target-libgccbuild-gcc$ make install-gccbuild-gcc$ make install-target-libgcc

Targets:

*   all-gcc : The very compiler binary and consecutive utilities for compiling source codes for our future OS in $TARGET=i686-elf  format.
*   all-target-libgcc : Build a low-level support library that the compiler expects available at compile time. Linking against [](https://www.google.com/url?q=https://wiki.osdev.org/Libgcc&sa=D&source=editors&ust=1703765820956284&usg=AOvVaw2bUVw4b94FJB2PcmHJRTRy)[libgcc](https://www.google.com/url?q=https://wiki.osdev.org/Libgcc&sa=D&source=editors&ust=1703765820956622&usg=AOvVaw1XrBj5d733stNy6RH24zoq) provides integer, floating point, decimal, stack unwinding (useful for exception handling) and other support functions. Note how we are not simply running make && make install as that would build way too much, not all components of gcc are ready to target your unfinished operating system.

“- OK. Now I can simply compile my OS units with this gcc. Piece of cake!” 

Having this simplest C code, that was also the first thing I thought.  

int main()  
{     //nothing here just empty main.c file           return 0;  
}  

I will hurry to disencourage you. Whenever you try to  compile the simplest program written in C Programming Language, you are most likely getting to face this kind of message from your freshly built compiler

 tyom@tyom\-pc  ~/workspace/LazyDaysOS  $HOME/opt/cross/bin/i686-elf-gcc ~/workspace/test/main.c  
/home/tyom/opt/cross/lib/gcc/i686-elf/14.0.0/../../../../i686-elf/bin/ld: cannot find crt0.o: No such file or directory/home/tyom/opt/cross/lib/gcc/i686-elf/14.0.0/../../../../i686-elf/bin/ld: cannot find -lc: No such file or directorycollect2: error: ld returned 1 exit status

Then the second question started to haunt me.

“- Why? What's the problem”

Let’s elaborate on this question, as the answer may seem on the surface - you do not have a standard library for your cross-compiler, but it has quite deep roots, which we need to understand, in order to have a clear image of what’s happening.

According to C Standard each executing environment can be classified as either

*   Freestanding

*   Freestanding example of a running environment is your OS kernel. It means that you won’t have any standard library implementations. All you have is a stripped Standard Library header-set, which is not even considered as a standard library piece, rather it is a GCC part. that can be implemented if one wants to.

*   or Hosted

*   Everything running in user space can be considered as hosted as you already have pretty and ready-to use runtime C library and you can easily link against all standard-supported libraries dynamically

After a little investigation it turns out that the errors of the compiler complaining about ctr0.o and \-lc absence is directly linked with absence of that very CRTL. So this kind of error now can be considered as pretty normal and common.

The next question I have had

“- How am I even supposed to solve this, though I know why these errors appear.”

Well, the answer became clearer when I googled the first question that came to mind.

It was like trying to hit a fly with a tank.

But eventually, filtering all unnecessary information I came up with some old forum from the iron age. The guy in the forum also was trying to compile a .c file into common i-686 ELF. After reading that forum I made one clear conclusion. I have to specify some flags to my custom built compiler in order to not to try to link against the Runtime library as it normally would have done.  

GCC has \-nostdlib flag։ This flag tells the compiler not to try to link against the Runtime library.

Alright!  Adding this flag to my compiler resolved linking issues, but other issues regarding to \_start symbol and overall entry point appeared. It says.  

tyom@tyom\-pc:~/workspace/LazyDaysOS/C\_test$ i686-elf-gcc-14.0.0  -nostdlib  main.c  
/home/tyom/opt/cross/lib/gcc/i686-elf/14.0.0/../../../../i686-elf/bin/ld: warning: cannot find entry symbol \_start; defaulting to 08048054

It is obvious that we can specify the entry point with the \-e flag. It, of course, solves the problem. But why did this problem even appear, when normally in a hosted environment I do not get this kind of issue?

The thing is that it is even better that we got this warning and here is why.

When compiling C code to generic i.e. non-hosted ELF format, GCC compiler supposes that you’ll have \_start as your entry point instead of main. Specifying main with \-e  flag is also acceptable, but not advisable.

* * *

§ 1.0 Booting the Operating System

Booting procedure starts when the user presses the “turn on” button on the computer.

First, the CPU executes hard coded JUMP instruction to the ROM location where BIOS is located. BIOS is now loaded into memory and next it executes Master Boot Record ([MBR](https://www.google.com/url?q=https://en.wikipedia.org/wiki/Master_boot_record&sa=D&source=editors&ust=1703765820964492&usg=AOvVaw0QbBKgiK_ZIYHKqyb6_y9L)) which is the very first sector that is loaded from drive, when booting happens. It’s 512 Bytes long memory block which can, then, boot Grand Unified Bootloader ([GRUB](https://www.google.com/url?q=https://www.gnu.org/software/grub/&sa=D&source=editors&ust=1703765820964880&usg=AOvVaw3iIBsi6jihIjIwsiFm6Xl-)), which is de-facto the first software application that is run on a machine, and the last phase where we do not have any control on the system. After this phase, the multiboot loader will try to find the multiboot header and magic in the kernel file’s first 8KiB length of memory. Further we’ll see those words in GNU Assembly language. After the GRUB phase is passed the control over the whole system is passed to the freshly booted kernel image, which we are going to build and implement.

BIOS

Basic input/output system executes Master Boot Record

MBR

Master Boot Record executes Grand Unified Bootloader

GRUB

Grand Unified Bootloader executes Kernel image

KERNEL

Kernel executes init process and OS is officially booted by that time

INIT

Init executes Run Level programs

USERSPACE

User Space software applications wait for user input

I already decided, that I will use GRUB as bootloader, though I have had some little experience in creating my own bootloader, in first phases of development IMHO it is crucial to have stable basis i.e. stable bootloader, so that the only development “bottleneck” will be our kernel and its corresponding modules. Our kernel image initially will be assembled from 2 files: boot.s and kernel.c.

As multiboot standard does not say a word about the state of the CPU by the time system control is passed to the booted kernel image, we need to explicitly specify CPU segment pointers. After these simple steps things are gonna be way more complex and rather interesting.

First, I again referred to OSDev Wiki in order to reconsider my choice of using GRUB instead of my custom bootloader, and OSDev Community delighted me, as they also advise to use GRUB first.

* * *

§ 1.1 First steps of the toddler kernel

First as every normal project requires a normal definition of working environment I started thinking about proper project nesting structure. And I came up with this folder-tree.

LazyDaysOS├── binutils-gdb            (binutils sources)  
├── build-binutils          (binutils build artifacts)  
├── build-gcc               (cross-gcc build artifacts)  
├── C\_test                  (tests for cross-compiler)  
├── gcc                     (cross-gcc sources)  
├── gdb-12.1                (gdb sources)  
└── kernel                  (kernel sources and binaries)  
       ├── boot.s           (lower level kernel code source)  
      ├── isodir           (end\-kernel image parent location)  
      │   └── boot         (end\-kernel image location)  
      │           └── grub       (grub-related files location)  
      ├── kernel.c         (higher-level kernel source file)  
      └── linker.ld        (linker script to manually link translated units)

boot.s

        GNU Assembly is quite unfamiliar to me, so I decided to devote my further week to investigations upon GAS and its advantages. Currently I am not sure about compatibility, but still don’t see any obstacles for using GAS.\[1 week later\] 

After week-long investigations and exploration, I filtered out some points why keeping using GAS seems more practical:

*   Absence of cross-configured nasm

*   We did not prepare a special nasm build for our needs, and with ubuntu provided nasm our binaries won’t be compatible with i686 builds.

*   GAS is the most common and sophisticated assembler in GNU world (name says it all)

*   For example GCC compiler generates assembly code in GAS syntax before translating to byte-code

*   NASM cross build configuration may be time consuming

And having all these pros against one from NASM side:

*   NASM has flat syntax and is easy-to-read at a first glance.

The answer is obvious to me. GAS! GNU assembler. In current stage of development we have only one unit written in GAS - boot.s  

/\* Declare constants for the multiboot header. \*/  
.set ALIGN,    1<<0             /\* align loaded modules on page boundaries \*/.set MEMINFO,  1<<1             /\* provide memory map \*/.set FLAGS,    ALIGN | MEMINFO  /\* this is the Multiboot 'flag' field \*/  
                          /\* 'magic number' lets bootloader find the header \*/.set MAGIC,    0x1BADB002                           /\* checksum of above, to prove we are multiboot \*/.set CHECKSUM, -(MAGIC + FLAGS)  
  
/\*Multiboot header\*/.section .multiboot.align 4  
.long MAGIC.long FLAGS.long CHECKSUM  
  
/\*Stack segment initialization\*/.section .bss.align 16  
stack\_bottom:  
.skip 16384 # 16 KiBstack\_top:/\*Code segment definition\*/.section .text.global \_start.type \_start, @function\_start: /\* The entry point of whole kernel image\*/        mov $stack\_top, %esp        call kernel\_main /\* Routine from kernel.c\*/        cli  
1:        hlt        jmp 1b  
  
.size \_start, . - \_start

The small code represented above boots our kernel stuff, concurrently allocating a stack for the kernel. Thus if we initialize the stack segment, it is pretty obvious that before our initialization we do not have any stack segment and even any register pointing to that very segment in memory, and it forces us to have %esp  segment defined to the top of stack (it grows backwards). Assigning %esp to the top of our stack needs code to be written, and we need a text section and code for that,  though it was pretty obvious.

mov $stack\_top, %esp line sets stack pointer to our freshly initialized stack top. So that we will have a point to start placing our stack stuff to.

call kernel\_main  This line calls the main kernel function from the linked kernel.o unit. This call can be considered as “entry point” for kernel routines, as everything done before is a more preparational process for kernel space to work fine.

In case kernel\_main unexpectedly returns, clear interrupt flag i.e. disable any interrupts, and afterwards call hlt in case any interrupt will be called despite  cli and then jump to that instruction if halt won’t function.

Besides being a so-called “booter” for our kernel, this unit plays a main role in recognizing our kernel image as bootable. As you may have noticed we intentionally skipped the header of our boot.s file.

.set ALIGN,    1<<0             /\* align loaded modules on page boundaries \*/  
.set MEMINFO,  1<<1             /\* provide memory map \*/  
.set FLAGS,    ALIGN | MEMINFO  /\* this is the Multiboot 'flag' field  
.set MAGIC,    0x1BADB002     /\* 'magic number' lets bootloader find the header  
.set CHECKSUM, -(MAGIC + FLAGS)    
/\* checksum of above, to prove we are multiboot \*/

These are macro-definitions. And are further used in structuring binary of kernel in the lines below.  

/\*Multiboot header\*/.section .multiboot  
.align 4  
.long MAGIC  
.long FLAGS  
.long CHECKSUM

This header for the multiboot kernel must meet the requirements provided in  [MultiBoot Standard](https://www.google.com/url?q=https://www.gnu.org/software/grub/manual/multiboot/multiboot.html&sa=D&source=editors&ust=1703765820979756&usg=AOvVaw3vhwXuzTND0JiFX77D-R60) and let’s have a look at what is said about headers in the standard.

“An OS image must contain an additional header called Multiboot header, besides the headers of the  
format used by the OS image. The Multiboot header must be contained completely within the first 8192 bytes of the OS image, and must be longword (32-bit) aligned. In general, it should come as early as possible, and may be embedded in the beginning of the text segment after the real executable header.”

“Multiboot Specification version 0.6.96.” GNU.org, https://www.gnu.org/software/grub/manual/multiboot/multiboot.html. Accessed 28 May 2023.

The Multiboot header layout is described in the table below.

Offset

Type

Field Name

Note

0

u32

magic

required

4

u32

flags

required

8

u32

checksum

required

12

u32

header\_addr

if flags\[16\] is set

16

u32

load\_addr

if flags\[16\] is set

20

u32

load\_end\_addr

if flags\[16\] is set

24

u32

bss\_end\_addr

if flags\[16\] is set

28

u32

entry\_addr

if flags\[16\] is set

32

u32

mode\_type

if flags\[2\] is set

36

u32

width

if flags\[2\] is set

40

u32

height

if flags\[2\] is set

44

u32

depth

if flags\[2\] is set

In early stages of development only 0x0 -...- 0x08 addresses of header : required ones, are only needed for kernel to be bootable.

Notice that header is required for header to be longword aligned, it is required for the bootloader, when it will try to find the magic of multiboot header in the first 8KiB of kernel it must be 4-byte aligned.

The last part that is left undiscussed is the initialization of the stack segment. But there is not much to discuss. The only thing that is noteworthy is that MutiBoot standard does not specify any %ESP% register value by the time of boot. And thus, it is up to us to create and initialize stack segment for kernel image  

/\*Stack segment initialization\*/  
.section .bss  
.align 16  
stack\_bottom:  
.skip 16384 \# 16 KiB  
stack\_top:

Our stack is 2 byte aligned and is 16KiB length, the  initialization of the stack will result in this state.

![](images/image3.png)

And… that’s it for now in boot.s, now let’s have a look at the kernel.c file.

* * *

kernel.c

Kernel entry point is located in this file - kernel\_main, which is called from boot.s, discussed above.

Currently at the minimal boot stage the only thing the kernel does, it calls some ttyIO functions from statically linked libk library, to be precise currently it has these lines of code.  

#include "kio.h"  
static bool boot\_successful = false;  
void kernel\_main(void)  
{   /\* Initialize terminal interface \*/  terminal\_initialize();  
   
  k\_printf("Setting up kernel...\\n");  
  
  boot\_successful = true;  if (boot\_successful){  
      k\_printf("Kernel is ready");    
  } else {  
      k\_printf("Kernel failed to set up");    
  }  
}

The first function called from main is terminal\_initialize(), which sets all required for terminal driver settings, for us to be able to output any ascii symbol onto the terminal. Terminal driver is considered as part of kernel input output (kio.h).

You may have also noticed the k\_printf function, which is part of libk. It will be renamed later and be discussed in libk. This function is a stripped analog of legacy C stdio printf function aka supports string buffer formatting.

boot\_successful  variable stores an overall state of a kernel running, this may possibly be removed later.

Kernel still has this state of existence, though we will observe the twist it will get during further development.

* * *

§ 1.2 Software and hardware Interrupt handling

\*\*NOTE\*\*

Till this moment of development I used good resource - OSDev.org, though in further module I used my common sense alongside some very old documents and historically antique forums and more implementation details will be covered in my github profile

\*\*NOTE\*\*

Interrupt handling is apparently the most important module (driver) for kernel for some reason - that is: Hardware interrupts serve as a bridge between your kernel and what lies on it and an end user, who generates that very interrupts. This explanation is pretty simplified, reality is more complex and full of frustration. I have been troubleshooting IPC driver, aka interrupt handler for over 3 months, as I simply haven’t had a good resource that could tell me what I have been troubleshooting for months in only one page of a simple article.

Hardware interrupts from PIC perspective  
Programmable interrupt controller  

-------------------------------------------------------------------------------

PIC (or APIC (Advanced PIC) in more modern CPUs) is a hardware circuit serving as a Mr. Regulator on crossroad. Image below is an example of a PIC chip produced by INTEL.![PIC Controller (8259A Intel)
](images/image4.png)

“ The Intel 8259A Programmable Interrupt Controller handles up to eight vectored priority interrupts for the CPU. It is cascadable for up to 64 vectored priority interrupts without additional circuitry. It is packaged in a 28-pin DIP, uses NMOS technology and requires a single a5V supply. Circuitry is static, requiring no clock input. The 8259A is designed to minimize the software and real time overhead in handling multi-level priority interrupts. It has several modes, permitting optimization for a variety of system requirements. The 8259A is fully upward compatible with the Intel 8259. Software originally written for the 8259 will operate the 8259A in all 8259 equivalent modes (MCS-80/85, Non-Buffered, Edge Triggered). “

 [https://pdos.csail.mit.edu/6.828/2018/readings/hardware/8259A.pdf](https://www.google.com/url?q=https://pdos.csail.mit.edu/6.828/2018/readings/hardware/8259A.pdf&sa=D&source=editors&ust=1703765820999031&usg=AOvVaw16HLMDIumhq-sGflygiCD5)

As quoted above this chip supports cascades, and is able to handle up to 64 cascaded chips (blows my mind)

Doing simple calculations, it is observable to state that the number of separate hardware devices interrupts of which will be possible to handle is 448 (63\*8).

Focusing on the pins on the right hand of the image you will see the IR\* pins, those are responsible for hardwares to be connected to. Every single PIC chip has an INT pin, which can be considered an ‘output’ pin. The last numbered PIC’s INT pin is connected to the CPU's corresponding pin.

Now let’s look a bit into the process of how PIC enqueues hardware interrupt requests or IRQs.

The implementation of IRQ enqueuing is pretty simple, and is done by the [atomic commit](https://www.google.com/url?q=https://en.wikipedia.org/wiki/Atomic_commit&sa=D&source=editors&ust=1703765821000171&usg=AOvVaw148oSKeQCCaNxF1JeY87Ux) technique. Every time CPU receives an hardware interrupt request from PIC chip, after completing the top half of interrupt handler routine (ISR) CPU  MUST send an ACK signal to PIC, in order to indicate the completion status (sent interrupt has been successfully handled, aka passed to its corresponding handler) and is ready to serve new interrupt request. Though PIC does not wait for CPU to send ACK without doing any kind of thing, it does a very important job - enqueues outer hardware interrupts in its buffer and relieves one at a time as soon as another ACK signal has been received from CPU.

So we are ensured that we won’t get any racing hardware interrupts as long as we sent ACK signals properly back

        That’s all required to know about PICs insights to implement handlers for hardware interrupts alongside with others. Though there is an unexplored sea to discover the inner schemes of how PIC has been developing throughout history.

Hardware and Software Interrupts from CPU perspective
-----------------------------------------------------

The most common question to ask ( I asked myself too ) is

  
“- How does CPU know when interrupt is received and what

happens with the instructions being executed when one is

 received from PIC”

Well, I was ready to dig through the old fashioned forums to find out the proper answer, and to my surprise, this topic was well discussed, and I found very good resources even video tutorials on this topic.

Let’s answer those questions step-by-step

### IDTR - Interrupt descriptor table register

This register in ix86 CPUs is responsible for storing the 6-byte address of memory where the interrupt descriptor table is stored. Of course this is not a general purpose register and has a special instruction to load that very address into IDTR.

For ix86 architectures this instruction is lidt.  

* * *

“ Loads the values in the source operand into the global descriptor table register (GDTR) or the interrupt descriptor table register (IDTR). The source operand specifies a 6-byte memory location that contains the base address (a linear address) and the limit (size of table in bytes) of the global descriptor table (GDT) or the interrupt descriptor table (IDT). If the operand-size attribute is 32 bits, a 16-bit limit (lower 2 bytes of the 6-byte data operand) and a 32-bit base address (upper 4 bytes of the data operand) are loaded into the register. If the operand-size attribute is 16 bits, a 16-bit limit (lower 2 bytes) and a 24-bit base address (third, fourth, and fifth byte) are loaded. Here, the high-order byte of the operand is not used and the high-order byte of the base address in the GDTR or IDTR is filled with zero”

[https://cdrdv2.intel.com/v1/dl/getContent/671436](https://www.google.com/url?q=https://cdrdv2.intel.com/v1/dl/getContent/671436&sa=D&source=editors&ust=1703765821002923&usg=AOvVaw2PU1SEL64a3Wx767P8F-_0)

* * *

### IDT - Interrupt descriptor table structure

The structure of interrupt descriptor table is very simple:

struct idt\_ptr\_struct {uint16\_t limit; /\* The upper 16 bits of the table with entries. \*/  
uint32\_t base;  /\* The address of the first idt\_entry\_t struct. \*/  
} \_\_attribute\_\_((packed));

The pointer to the instance of this structure will eventually be stored in the IDTR register.

There is a special function that ‘drains’ the ready IDT address to its final destination

.global idt\_buf\_drain  
.type idt\_buf\_drain, @function  
idt\_buf\_drain:  
  lidt (%eax)  ret

![](images/image5.png)

Figure 4. IDTR Register content and how stored address related to the IDT table

In Figure 4 you can see ‘Gate for Interrupt #n’. Those ‘Gates’ are 32 bit length structures which have some kind of ‘complex’ structure which is shown in Figure 5.

![](images/image1.png)

 Figure 5. Single IDT Entry/Gate structure.

The one and only MUST you have to preserve in C style structure of IDT Gates is to have \_\_attribute\_\_((packed)); in order to avoid possible memory alignment, as these kinds of structures do not like to be aligned.

/\* This structure contains the value of one IDT entry.  
\* We use the attribute 'packed' to tell GCC not to change  
\* any of the alignment in the structure.  
\*/  
struct idt\_entry\_struct {    uint16\_t offset\_low;    /\* The lowest 16 bits of the 32 bit ISR address.\*/    uint16\_t segment\_selector; /\* Segment Selector. \*/    uint8\_t alwaysZero;        /\* This 8 bits are always 0. \*/    uint8\_t access\_gran;  /\* Access flags, granularity and few reserved bits.\*/    uint16\_t offset\_high; /\* The highest 16 bits of the 32 bit ISR address. \*/  
} \_\_attribute\_\_((packed));

### PIC Initialization control words

Even without getting acknowledged with the PIC chips it seems obvious that as it has many possible states to work, we must ‘tell’ him the ‘how’. Those are the initialization vectors that let us tell PIC how to work.

According to INTEL’s  8259A PROGRAMMABLE INTERRUPT CONTROLLER (8259A/8259A-2) documentation :

* * *

        “ - Before normal operation can begin, each 8259A in the system must be brought to a starting point–by a sequence of 2 to 4 bytes timed by WR pulses”

* * *

#### ICW1

The first ICW must tell the PIC chip

*   Edge or level triggered mode
*   Single or cascaded mode
*   Call address interval
*   ICW4 required or not

![](images/image7.png)

Figure 6. ICW1 Structure

#### ICW2

The second ICW must tell the PIC chip the addresses of access for each PIC controller, shown in Figure 7.

![](images/image6.png)

Figure 7. ICW2 Structure

#### ICW3

The third ICW must tell -each- PIC chip whether that very chip has a slave or it is a slave, shown in Figure 8.

![](images/image2.png)

Figure 8. ICW3 Structure

For example in init\_pic routine here is used the ICW 3 in order to tell each PIC its cascade-model role.

/\* initialization control word 3 \*/  
  
// tell PIC1 that it has a slave at IRQ2 (0000 0100)        outb(PIC1\_DATA\_PORT, 0x4);        iowait();  
// tell PIC2 its cascade identity (0000 0010)        outb(PIC2\_DATA\_PORT, 0x2);        iowait();

                           ICW3 used in LazyDaysOS

#### ICW4

Whether the fourth ICW is intended or not is defined in the first ICW (Figure 6.), and the 4th ICW, and it mainly defines the compatibility and more specific-to-implementation stuff. Specifically

*   When AEOI = 1, then the Automatic end of interrupt mode is selected.
*   When SFMN = 1, then a special fully nested mode is selected.
*   when BUF = 0 , then Non buffered mode is used (i.e. M/S doesn't care) and when M/S = 1, then 8259 is master, otherwise it is a slave.
*   when µPM = 1, then 8086 operations are performed, otherwise 8085 operations are performed.

After these three (four) ICWs are performed correctly it is supposed that Hardware interrupts will be processed. Of course unless the Interrupt Vector Table is set up.

* * *

\*\*FUN FACT\*\*  

I have spent around 3 months debugging the interrupt handling stuff, have read an infinite amount of the literature,  still not being able to find out the problem when all the interrupt handling procedures are done (described above), though still seeing some erroneous output. Why the word output is bolded, because it was the root cause, and I could have gone crazy without the remote debugger.

To be concise, the k\_print (DMA based VGA driver) was being called every time ANY interrupt was being received. And  as the matter of fact that I did not have protected mode enabled I kept receiving CPU interrupts  
(number 13th IRQ) and the k\_print(13) call were jamming all the interrupts I have been receiving from the PIC chip (timer and keyboard interrupts). Removing the unconditional k\_print resolved the issue and probably saved me another 3 months of mad staring into the 50 lines of assembly code.

\*\*FUN FACT\*\*

* * *

* * *

[\[1\]](#ftnt_ref1) Project folder - it is advisable to have all downloaded repositories and sources alongside with build object under one parent folder, as we plan to make a feasible barrier between our host OS and LazyDaysOS
